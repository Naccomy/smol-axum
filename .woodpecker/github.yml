when:
- event: push
  branch: main

steps:
  github_mirror:
    image: alpine:latest
    secrets: [ github_ssh_key ]
    commands:
      - apk --no-cache update -q
      - apk --no-cache add git openssh
      - mkdir -pv $HOME/.ssh
      - ssh-keyscan -H -t rsa github.com >> $HOME/.ssh/id_rsa
      - echo "$GITHUB_SSH_KEY" > "$HOME/.ssh/id_rsa" && chmod 0600 $HOME/.ssh/id_rsa
      - git remote add github_origin git@github.com:notgull/smol-axum.git
      - git push github_origin main 